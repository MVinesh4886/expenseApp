<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
      crossorigin="anonymous"
    />
    <title>Expense Tracker</title>
  </head>
  <body>
    <h1 style="text-align: center">Expense Tracker</h1>
    <div>
      <label for="expenseAmount">Choose Expense Amount:</label>
      <input type="text" id="expenseAmount" />

      <label for="description">Choose Description:</label>
      <input type="text" id="description" />

      <label for="category">Choose Category:</label>
      <select id="category">
        <option>Food</option>
        <option>Fuel</option>
        <option>Electricity</option>
        <option>Recharge</option>
      </select>

      <button id="addExpense">Add Expense</button>
      <br />
      <button id="razorpay">Buy Premium</button>
      <ul id="expenseList"></ul>
    </div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.min.js"></script>
    <script>
      let expenseInput = document.getElementById("expenseAmount");
      let descriptionInput = document.getElementById("description");
      let categoryInput = document.getElementById("category");

      let addExpenseButton = document.getElementById("addExpense");
      let expenseList = document.getElementById("expenseList");

      let expenses = [];

      let userId = ""; // Declare a variable to store the userId
      // let token = ""; // Declare a variable to store the token

      // Retrieve the userId from local storage
      if (localStorage.userDetails) {
        const userDetails = JSON.parse(localStorage.userDetails);
        userId = userDetails.userId;
        // token = userDetails.token;
      }

      if (localStorage.expenses) {
        expenses = JSON.parse(localStorage.expenses);
      }

      addExpenseButton.addEventListener("click", async function () {
        let expenseAmount = expenseInput.value;
        let description = descriptionInput.value;
        let category = categoryInput.value;

        let expense = {
          amount: expenseAmount,
          description,
          category,
          userId,
          // token,
        };
        console.log(expense);
        try {
          const token = JSON.parse(localStorage.getItem("userDetails")).token;

          const response = await axios.post(
            "http://localhost:8000/expense/create",
            expense,
            {
              headers: {
                Authorization: `Bearer ${token} `,
              },
            }
          );
          console.log(response);
          alert("added expenses successfully to the database");
        } catch (error) {
          console.log(error);
          alert("Request failed with status code 400");
        }

        expenses.push(expense);
        localStorage.expenses = JSON.stringify(expenses);

        expenseInput.value = "";
        descriptionInput.value = "";
        displayExpenses();
      });

      function displayExpenses() {
        expenseList.innerHTML = "";

        for (let i = 0; i < expenses.length; i++) {
          let listItem = document.createElement("li");
          listItem.innerHTML = `Expense Amount: ${expense.amount}, Description: ${expense.description}, Category: ${expense.category}`;

          let deleteButton = document.createElement("button");
          deleteButton.innerHTML = " Delete";
          deleteButton.addEventListener("click", function () {
            expenses.splice(i, 1);
            localStorage.expenses = JSON.stringify(expenses);
            displayExpenses();
          });

          let editButton = document.createElement("button");
          editButton.textContent = " Edit";
          editButton.addEventListener("click", function () {
            expenseInput.value = expense.amount;
            descriptionInput.value = expense.description;
            categoryInput.value = expense.category;
            expenses.splice(i, 1);
            localStorage.expenses = JSON.stringify(expenses);
            displayExpenses();
          });

          listItem.appendChild(deleteButton);
          listItem.appendChild(editButton);
          expenseList.appendChild(listItem);
        }
      }
      displayExpenses();
    </script>
  </body>
</html>


//////////////////////////////

   editButton.addEventListener("click", function () {
            // Create input fields for editing
            const amountInput = document.createElement("input");
            amountInput.type = "text";
            amountInput.value = expense.amount;

            const descriptionInput = document.createElement("input");
            descriptionInput.type = "text";
            descriptionInput.value = expense.description;

            const categoryInput = document.createElement("select");
            const categories = ["Food", "Fuel", "Electricity", "Recharge"];
            for (let i = 0; i < categories.length; i++) {
              const option = document.createElement("option");
              option.text = categories[i];
              option.value = categories[i];
              if (categories[i] === expense.category) {
                option.selected = true;
              }
              categoryInput.appendChild(option);
            }

            // Replace expense details with input fields
            listItem.innerHTML = "";
            listItem.appendChild(amountInput);
            listItem.appendChild(descriptionInput);
            listItem.appendChild(categoryInput);

            // Create save button
            const saveButton = document.createElement("button");
            saveButton.textContent = "Save";
            saveButton.addEventListener("click", async function () {
              const updatedAmount = amountInput.value;
              const updatedDescription = descriptionInput.value;
              const updatedCategory = categoryInput.value;

              const updatedExpense = {
                amount: updatedAmount,
                description: updatedDescription,
                category: updatedCategory,
              };

              try {
                const token = JSON.parse(
                  localStorage.getItem("userDetails")
                ).token;

                const response = await axios.put(
                  `http://localhost:8000/expense/put/${expense.id}`,
                  updatedExpense,
                  {
                    headers: {
                      Authorization: `Bearer ${token}`,
                    },
                  }
                );

                console.log(response.data);
                expense.amount = updatedAmount;
                expense.description = updatedDescription;
                expense.category = updatedCategory;
                alert("Expense updated successfully in the database");
              } catch (error) {
                console.log(error);
                alert("Request failed with status code 400");
              }

              // Update the local storage
              localStorage.setItem("expenses", JSON.stringify(expenses));

              // Update the displayed expenses
              displayExpenses();
            });

            // Replace edit button with save button
            listItem.appendChild(saveButton);
          });